SET @step_all = (SELECT COUNT(DISTINCT step_id) FROM step_student);
WITH get_correct (student_name, count_correct) 
		AS (
			SELECT student_name, COUNT(DISTINCT step_id) AS count_correct
			  FROM step_student
				   JOIN student USING (student_id)
			 WHERE result = "correct"
			 GROUP BY student_id, student_name
		   )  
 SELECT student_name AS Студент, 
		ROUND((count_correct/@step_all) * 100) AS Прогресс,
		CASE 
			WHEN Прогресс = 100 THEN 'Сертификат с отличием'
			WHEN Прогресс => 80 THEN 'Сертификат'
			ELSE ''
		END
   FROM
		get_correct 
  ORDER BY 2 DESC, 1;