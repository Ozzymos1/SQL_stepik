   WITH get_time_lesson(Студент, Урок, Макс_время_отправки) 
	    AS 
		(
		 SELECT student_name AS Студент, 
				CONCAT(module_id, '.', lesson_position) AS Урок,
				FROM_UNIXTIME(MAX(submission_time)) AS Макс_время_отправки
		   FROM student
				JOIN step_student USING(student_id)
				JOIN step USING(step_id)
				JOIN lesson USING(lesson_id)
		  WHERE result = 'correct'
		  GROUP BY Студент, Урок
		  ORDER BY Студент, Макс_время_отправки
		),
        get_student_three_lesson(Студент)
	    AS
		(
		 SELECT Студент
		   FROM get_time_lesson
		  GROUP BY Студент
		 HAVING COUNT(Урок) > 2
		  ORDER BY Студент
		)
 SELECT get_student_three_lesson.Студент,
		Урок,
		Макс_время_отправки,
        IFNULL(CEILING(TIMESTAMPDIFF(
                          SECOND,
                          LAG(Макс_время_отправки)
                          OVER (PARTITION BY Студент ORDER BY Макс_время_отправки),
                          Макс_время_отправки
                          )/86400
                        ),'-'
                ) AS Интервал
   FROM get_student_three_lesson
		JOIN get_time_lesson USING(Студент)
  ORDER BY Студент, Макс_время_отправки;